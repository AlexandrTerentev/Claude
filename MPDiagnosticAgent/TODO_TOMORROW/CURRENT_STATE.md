# –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ - MPDiagnosticAgent v6.0

**–î–∞—Ç–∞:** 2025-12-07 (–∫–æ–Ω–µ—Ü –¥–Ω—è)
**–°—Ç–∞—Ç—É—Å:** AI Integration –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢

### 1. Unified Application (agent_ran)
```bash
agent_ran              # –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è GUI
agent_ran --cli        # CLI —Ä–µ–∂–∏–º
agent_ran --version    # MPDiagnosticAgent v6.0
```

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- 4 –≤–∫–ª–∞–¥–∫–∏: AI Assistant, Auto-Fix, Download Logs, Settings
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –¥—Ä–æ–Ω—É —á–µ—Ä–µ–∑ MAVLink
- –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### 2. Auto-Fix System
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ (battery, rc, gps, compass)
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è FixAction –æ–±—ä–µ–∫—Ç–æ–≤
- ‚úÖ –ö–Ω–æ–ø–∫–∏ "Apply Fix"
- ‚úÖ –ó–∞–ø–∏—Å—å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ MAVLink

### 3. Log Download
- ‚úÖ –°–ø–∏—Å–æ–∫ –ª–æ–≥–æ–≤ —Å –¥—Ä–æ–Ω–∞
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ MAVLink
- ‚ö†Ô∏è –ú–æ–∂–µ—Ç —Ç–∞–π–º–∞—É—Ç–∏—Ç—å—Å—è –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö

### 4. Pattern Matching Q&A
- ‚úÖ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ: "–∞–Ω–∞–ª–∏–∑", "–ø–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏", "–∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å?"
- ‚ö†Ô∏è –ù–û: –û—á–µ–Ω—å –ø—Ä–∏–º–∏—Ç–∏–≤–Ω–æ–µ, –Ω–µ –Ω–∞—Å—Ç–æ—è—â–∏–π AI

---

## ‚ùå –ß–¢–û –ù–ï –†–ê–ë–û–¢–ê–ï–¢

### 1. AI Assistant (–û–°–ù–û–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê!)
**–ü—Ä–æ–±–ª–µ–º–∞:** –û—Ç–≤–µ—á–∞–µ—Ç —à–∞–±–ª–æ–Ω–Ω—ã–º–∏ —Ñ—Ä–∞–∑–∞–º–∏, –Ω–µ—Ç —É–º–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pattern matching –≤–º–µ—Å—Ç–æ Claude API

**–†–µ—à–µ–Ω–∏–µ:** –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `ask_claude_api()` –≤ unified_agent.py, –Ω–æ:
- –ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- Claude CLI –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –ù—É–∂–µ–Ω fallback –Ω–∞ Ollama/OpenAI

### 2. GitHub Dataset Integration
**–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:** –ù–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ArduPilot

**–ù—É–∂–Ω–æ:** –°–∫–∞—á–∏–≤–∞—Ç—å Wiki —Å GitHub –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ AI

### 3. Smart Fix Generation
**–°–µ–π—á–∞—Å:** –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ–¥–µ

**–ù—É–∂–Ω–æ:** AI –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
MPDiagnosticAgent/
‚îú‚îÄ‚îÄ main.py                    # Unified GUI (643 —Å—Ç—Ä–æ–∫–∏)
‚îú‚îÄ‚îÄ agent_ran (symlink)        # –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
‚îú‚îÄ‚îÄ install.sh                 # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ /usr/local/bin
‚îú‚îÄ‚îÄ install_user.sh            # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ ~/bin
‚îÇ
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ mavlink_interface.py  # MAVLink —Å–≤—è–∑—å
‚îÇ   ‚îú‚îÄ‚îÄ log_analyzer.py        # –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ log_downloader.py      # –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ unified_agent.py       # AI CORE (560+ —Å—Ç—Ä–æ–∫) ‚ö†Ô∏è –ó–î–ï–°–¨ –ü–†–û–ë–õ–ï–ú–ê!
‚îÇ   ‚îî‚îÄ‚îÄ knowledge_base.py      # –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
‚îÇ
‚îú‚îÄ‚îÄ interfaces/
‚îÇ   ‚îú‚îÄ‚îÄ cli.py                 # CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (legacy)
‚îÇ   ‚îú‚îÄ‚îÄ gui_standalone.py      # –°—Ç–∞—Ä—ã–π GUI (legacy)
‚îÇ   ‚îî‚îÄ‚îÄ gui_unified.py         # GUI —Å —á–∞—Ç–æ–º (500+ —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ installation.md
‚îÇ   ‚îú‚îÄ‚îÄ user_guide.md
‚îÇ   ‚îî‚îÄ‚îÄ troubleshooting.md
‚îÇ
‚îî‚îÄ‚îÄ TODO_TOMORROW/             # ‚Üê –í–´ –ó–î–ï–°–¨!
    ‚îú‚îÄ‚îÄ README.md
    ‚îú‚îÄ‚îÄ PLAN.md
    ‚îî‚îÄ‚îÄ CURRENT_STATE.md
```

---

## üîç –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

### core/unified_agent.py (–°–ê–ú–´–ô –í–ê–ñ–ù–´–ô!)

**–ú–µ—Ç–æ–¥ ask_claude_api() - –£–ñ–ï –î–û–ë–ê–í–õ–ï–ù (—Å—Ç—Ä–æ–∫–∞ 406-472):**
```python
def ask_claude_api(self, query: str, context: str = "") -> str:
    """Ask Claude AI with full drone context (REAL AI!)"""
    # –°–æ–±–∏—Ä–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç: PreArm –æ—à–∏–±–∫–∏, —Å—Ç–∞—Ç—É—Å –¥—Ä–æ–Ω–∞, auto-fix
    # –í—ã–∑—ã–≤–∞–µ—Ç: subprocess.run(["claude", full_context], ...)
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: —É–º–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Claude
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–µ—Ç–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω, –Ω–æ:
1. –ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
2. Claude CLI –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å
3. –ù—É–∂–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `which claude`
2. –ï—Å–ª–∏ –Ω–µ—Ç - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Ollama
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤–æ–ø—Ä–æ—Å–æ–º

### main.py

**–ú–µ—Ç–æ–¥ send_message() (—Å—Ç—Ä–æ–∫–∞ 409-427):**
```python
def send_message(self):
    message = self.input_var.get().strip()
    answer = self.agent.answer_question(message)  # ‚Üê –í—ã–∑—ã–≤–∞–µ—Ç AI
    self.add_agent_message(answer)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç progress –ø—Ä–∏ –¥–æ–ª–≥–æ–º –æ—Ç–≤–µ—Ç–µ AI (90 —Å–µ–∫ —Ç–∞–π–º–∞—É—Ç)

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏–ª–∏ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å AI

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≥–µ–Ω—Ç
agent_ran

# 2. –í AI Assistant –Ω–∞–ø–∏—Å–∞—Ç—å:
"–ü–æ—á–µ–º—É –¥—Ä–æ–Ω –Ω–µ –≤–∑–ª–µ—Ç–∞–µ—Ç?"

# 3. –°–º–æ—Ç—Ä–µ—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª:
# –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è: "üß† –ü—ã—Ç–∞—é—Å—å —Å–ø—Ä–æ—Å–∏—Ç—å Claude AI..."

# 4. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Claude CLI:
which claude

# –ï—Å–ª–∏ –Ω–µ—Ç - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
npm install -g @anthropics/claude-cli
claude auth login
```

---

## üîß –ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–∫—Å—ã –Ω–∞ –∑–∞–≤—Ç—Ä–∞

### Fix 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ Claude CLI –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
–î–æ–±–∞–≤–∏—Ç—å –≤ `main.py.__init__()`:
```python
def check_ai_available(self):
    """Check if Claude CLI is available"""
    try:
        subprocess.run(["which", "claude"], check=True, capture_output=True)
        return True
    except:
        return False
```

### Fix 2: Fallback –Ω–∞ Ollama
–î–æ–±–∞–≤–∏—Ç—å –≤ `unified_agent.py`:
```python
def ask_ollama(self, query: str) -> str:
    """Fallback to Ollama if Claude not available"""
    result = subprocess.run(
        ["ollama", "run", "llama2", query],
        capture_output=True, text=True
    )
    return result.stdout
```

### Fix 3: GitHub Docs Loader
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `core/github_dataset.py`:
```python
import requests

class GitHubDataset:
    def download_ardupilot_wiki(self):
        # Clone https://github.com/ArduPilot/ardupilot_wiki
        pass

    def search(self, query: str) -> str:
        # Grep in local docs
        pass
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–∞

```
–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤: 20+
–í—Å–µ–≥–æ —Å—Ç—Ä–æ–∫: ~5000
–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥:
  - main.py: 643 —Å—Ç—Ä–æ–∫–∏
  - unified_agent.py: 560+ —Å—Ç—Ä–æ–∫
  - gui_unified.py: 500+ —Å—Ç—Ä–æ–∫
  - log_downloader.py: 529 —Å—Ç—Ä–æ–∫
```

---

## üêõ –ë–∞–≥–∏ –¥–ª—è —Ñ–∏–∫—Å–∞

1. **–ö–†–ò–¢–ò–ß–ù–û:** AI –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç —É–º–Ω–æ (pattern matching)
2. **–í–ê–ñ–ù–û:** –ù–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –ø—Ä–∏ –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
3. **–í–ê–ñ–ù–û:** Claude CLI –º–æ–∂–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å (–Ω—É–∂–µ–Ω fallback)
4. **–°–†–ï–î–ù–ï–ï:** Auto-Fix —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–Ω—É–∂–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è AI)
5. **–ù–ò–ó–ö–û–ï:** LOG_DATA download —Ç–∞–π–º–∞—É—Ç—ã

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

**–ó–∞–≤—Ç—Ä–∞ —É—Ç—Ä–æ–º (–ü–ï–†–í–´–ú –î–ï–õ–û–ú!):**

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å Claude CLI:**
   ```bash
   which claude
   ```

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å ask_claude_api():**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å agent_ran
   - –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

3. **–ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Claude CLI
   - –ò–õ–ò –¥–æ–±–∞–≤–∏—Ç—å Ollama fallback
   - –ò–õ–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI API

4. **–î–æ–±–∞–≤–∏—Ç—å GitHub dataset:**
   - –°–æ–∑–¥–∞—Ç—å core/github_dataset.py
   - –ó–∞–≥—Ä—É–∑–∏—Ç—å ArduPilot Wiki
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ ask_claude_api()

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- –°—Ç–∞—Ä—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä: `/home/user_1/missionplanner/diagnostic_agent_pro.py`
- –¢–∞–º –µ—Å—Ç—å –º–µ—Ç–æ–¥ `ask_claude()` –∫–æ—Ç–æ—Ä—ã–π –†–ê–ë–û–¢–ê–ï–¢
- –ú–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –æ—Ç—Ç—É–¥–∞

---

**–£–¥–∞—á–∏ –∑–∞–≤—Ç—Ä–∞! üöÄ**
